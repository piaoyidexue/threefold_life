

# 《圣焰:三重人生》 终极游戏设计白皮书 (Final GDD v3.0)

## 1. 游戏概述 (Executive Summary)
*   **游戏类型**：**RPG养成** (角色成长) + **塔防PVE** (守卫基地) + **非对称PVP** (狼人杀/变身乱斗)。
*   **核心体验**：在对抗无穷无尽的怪物潮的同时，找出隐藏在队伍中的背叛者。是牺牲资源来维持视野，还是保留资源孤注一掷？
*   **玩家人数**：5 - 10 人（推荐标准局：8人 = 6守护者 + 1潜行者 + 1信徒）。
*   **单局时长**：20 - 35 分钟。

---

## 2. 阵营与胜利条件 (Factions & Win Conditions)

### 2.1 圣焰守护者 (Civilian - 好人)
*   **目标**：守护基地“圣焰”直到第 N 天（如第10天），或击败最终Boss。
*   **核心机制：命运共同体**
    *   **全员共享经验**：任意好人击杀单位，**全队经验条**增长。解决“抢怪/挂机”矛盾，辅助也能升级。
    *   **个人金币**：金币独立掉落/获取，各自购买装备。
*   **死亡**：变为“幽灵”（只能移动开视野），夜晚复活，但**扣除圣焰 5% 生命上限**。

### 2.2 暗影潜行者 (Traitor - 内奸)
*   **目标**：圣焰生命值归零（基地被毁）。
*   **核心机制：双面人**
    *   **伪装态**：白天无法攻击队友，拥有“暗影行囊”UI。
    *   **杀戮态**：使用技能【遁入暗影】变身为强大怪物（如影魔/末日），技能组完全改变，可攻击好人。
*   **暗影行囊 (Shadow Bag)**：
    *   独立于Dota2原生装备栏的**虚拟库存**。
    *   购买“暗影碎片”、“怪物强化卡”等道具**不占用身上格子**，好人检查装备栏无法发现。

### 2.3 狂热信徒 / 审判者 (The Judge - 第三方)
*   **目标**：**全员肃清**。不仅要圣焰熄灭，还要场上除自己外无人生还（或存活人数 < 2）。
*   **流程**：
    1.  **信徒阶段**：甚至比好人更脆。必须诱导好人或内奸将自己杀死。
    2.  **觉醒阶段**：死后复活为**审判者**（中立Boss），获得技能【灵魂收割】（杀人滚雪球）。
    3.  **搅屎棍策略**：先帮好人杀内奸（骗取信任），再帮怪物拆基地，最后收割残局。

---

## 3. 核心资源系统：光辉 (The Radiance)

将原有的“余烬”、“光辉度”合并为单一核心资源，制造博弈冲突。

### 3.1 光辉度 (0 - 100)
*   **定义**：既是基地的“魔法值”，也是全队共享的“环境Buff”。
*   **获取**：击杀野怪/Boss 自动增加光辉度。
*   **消耗**：
    *   **维持环境**：随时间自然衰减（每秒 -0.5）。
    *   **功能性消耗**：**购买团队光环、修补防御塔、发起审判**都需要消耗光辉度。
*   **博弈点**：
    *   *高光辉（>75）*：全图视野 + 高额回血。
    *   *低光辉（<25）*：全图迷雾 + 怪物暴击。
    *   *矛盾*：好人需要用光辉去修塔或买光环，但用多了会导致光辉降低、视野变黑、更容易被内奸偷袭。**谁乱用了光辉，谁就是嫌疑人。**

---

## 4. 游戏循环 (The Game Loop)

游戏按 **白天 (3m) -> 夜晚 (2m)** 循环，第3/6/9天难度跃升。

### 4.1 白天：备战与暗流 (Day Phase)
*   **全图视野**：根据光辉度决定。
*   **圣坛争夺 (Altar Event)**：
    *   地图四角刷新 4 个小型圣坛。
    *   **占领**：英雄站上去 10秒 可激活圣坛，夜晚为基地提供 +10 护甲或 +5% 金币。
    *   **破坏**：内奸可以悄悄“逆向占领”使其失效。
    *   *目的*：强迫玩家分散跑图，给内奸制造落单杀人机会。
*   **审判台 (Judgment)**：
    *   消耗 **20 光辉** 发起投票。
    *   若**投对（内奸）**：内奸死亡（超长复活CD）。
    *   若**投错（好人）**：被投死者死亡，**发起者陪葬（死亡）**，光辉度**直接扣除 30点**（瞬间天黑）。

### 4.2 夜晚：守望与杀戮 (Night Phase)
*   **强制回城**：所有人传送回基地。
*   **亡者复活**：所有幽灵复活（扣除圣焰生命上限）。
*   **怪物攻城**：
    *   怪物无视地形冲向基地。
    *   **AI优化**：每波怪分为“攻城组”（只打塔）和“猎杀组”（追着英雄咬）。
*   **内奸时刻**：
    *   趁场面混乱，开启【怪物强化卡】（如：本波怪魔免）。
    *   或直接变身，在背后秒杀关键输出位。

---

## 5. 主动挑战机制 (The Meta Switches)

防止游戏变成枯燥的挂机防守，提供“高风险高回报”开关。

### 5.1 内奸：血月契约 (Blood Moon)
*   **条件**：商店购买（需积攒大量暗影碎片）。
*   **效果**：
    *   **强制锁光**：光辉度锁定为 100（给好人最强视野，嘲讽拉满）。
    *   **明牌杀戮**：内奸强制变身且无法变回，位置全图暴露。
    *   **死亡倒计时**：内奸若在 3分钟内 未推平基地，则**直接暴毙且无法复活**。

### 5.2 审判者：末日丧钟 (Doomsday Bell)
*   **条件**：审判者存活且场上人数 > 4人。
*   **效果**：
    *   **大逃杀模式**：停止刷怪，圣焰不再回血。
    *   **死斗**：所有玩家互相皆为敌对。光辉度归零（全黑）。
    *   **胜利**：活到最后的唯一一人获胜。

---

## 6. 防恶意破坏机制 (Anti-Griefing)

### 6.1 圣火重燃 (Reignite)
*   若内奸在开启“血月”后 60秒内 被秒杀（判定为恶意送人头/不会玩）：
    *   所有已死好人立刻复活。
    *   圣焰回满血。
    *   系统提示：“伪神陨落，圣火重燃！”（给好人一次翻盘机会）。

### 6.2 门槛锁 (Gatekeeper)
*   前 10分钟 禁止使用审判台。
*   前 15分钟 禁止开启“血月”或“丧钟”。

---

## 7. 技术架构与开发清单 (Dev Implementation)

基于 `ModDota/TypeScriptAddonTemplate`。

### 7.1 目录结构
```text
src/vscripts/
├── GameLoop.ts            // 状态机：白天/夜晚/决战
├── components/
│   ├── RoleManager.ts     // 身份分配、胜利判定
│   ├── SharedExperience.ts// 共享经验逻辑
│   ├── RadianceSystem.ts  // 光辉度核心逻辑
│   ├── ShadowBag.ts       // 内奸虚拟库存逻辑
│   └── Judgment.ts        // 投票与处决
├── abilities/
│   ├── traitor_abilities/ // 内奸变身技能
│   └── judge_abilities/   // 审判者技能
└── filters/
    └── InventoryFilter.ts // 拦截内奸买装备，转入ShadowBag
```

### 7.2 关键逻辑实现

**A. 暗影行囊 (Shadow Bag - Inventory Filter)**
```typescript
// 伪代码：拦截购买请求
public OnItemAddedToInventory(event: any) {
    const item = EntIndexToHScript(event.item_entindex);
    const hero = EntIndexToHScript(event.inventory_parent_entindex);

    // 如果是内奸道具
    if (IsTraitorItem(item.GetName()) && IsTraitor(hero)) {
        // 阻止进入常规栏位
        item.RemoveSelf();
        // 添加到虚拟库存并更新UI
        CustomGameEventManager.Send_ServerToPlayer(hero.GetPlayerOwner(), "update_shadow_bag", { item: item.GetName() });
        return false;
    }
    return true;
}
```

**B. 处决逻辑 (True Execution)**
```typescript
// 确保杀死骷髅王/带盾英雄
function ExecuteHero(hero: CDOTA_BaseNPC_Hero) {
    hero.RemoveModifierByName("modifier_item_aegis"); // 移除盾
    hero.RemoveModifierByName("modifier_skeleton_king_reincarnation"); // 移除复活

    ApplyDamage({
        victim: hero,
        attacker: GameRules.GetGameModeEntity(),
        damage: 1000000,
        damage_type: DAMAGE_TYPE_PURE,
        damage_flags: DOTA_DAMAGE_FLAG_BYPASSES_INVULNERABILITY
    });
}
```

### 7.3 UI 需求 (Panorama)
1.  **Top Bar**: 天数 / 圣焰血量 / **光辉度条（动态火焰特效）**。
2.  **Shadow Bag Panel**: 仅内奸可见。右下角小图标，点击展开，显示拥有的碎片数量和卡牌。
3.  **Role Card**: 开局弹窗，身份介绍。
4.  **Altar Status**: 小地图上显示4个圣坛的占领状态（绿/红/灰）。

---

## 8. 数值平衡参考 (Balance Guideline)

*   **初始金币**：600
*   **光辉度上限**：100
*   **光辉衰减**：白天 -0.2/秒，夜晚 -0.8/秒。
*   **击杀回复光辉**：普通怪 +0.5，精英怪 +5，Boss +30。
*   **审判消耗**：每次固定 20 - 30 光辉度（非常昂贵的代价）。
*   **圣焰血量**：10000（随波次成长）。
*   **复活代价**：每次复活扣除 5% - 8% 圣焰当前上限。

---

此文档已具备交付标准，逻辑闭环，风险可控。建议按照 **核心循环 -> 角色技能 -> UI实现 -> 数值调整** 的顺序进行开发。
